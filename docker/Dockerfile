FROM node:22-alpine AS build

WORKDIR /app

COPY package.json ./
RUN npm i

ENV VITE_APP_NAME=VITE_APP_NAME
ENV VITE_API_URL=VITE_API_URL

ENV VITE_FIREBASE_API_KEY=VITE_FIREBASE_API_KEY
ENV VITE_FIREBASE_AUTH_DOMAIN=VITE_FIREBASE_AUTH_DOMAIN
ENV VITE_FIREBASE_PROJECT_ID=VITE_FIREBASE_PROJECT_ID
ENV VITE_FIREBASE_STORAGE_BUCKET=VITE_FIREBASE_STORAGE_BUCKET
ENV VITE_FIREBASE_MESSAGING_SENDER_ID=VITE_FIREBASE_MESSAGING_SENDER_ID
ENV VITE_FIREBASE_APP_ID=VITE_FIREBASE_APP_ID
ENV VITE_FIREBASE_MEASUREMENT_ID=VITE_FIREBASE_MEASUREMENT_ID

COPY . .
RUN npm run build

FROM nginx:alpine AS production

WORKDIR /var/www/html

COPY --from=build /app/dist ./

# Add permissions if needed
RUN chmod -R 755 .

COPY docker/nginx/entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh
ENTRYPOINT ["entrypoint.sh"]